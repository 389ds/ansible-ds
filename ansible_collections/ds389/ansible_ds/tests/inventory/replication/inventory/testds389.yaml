---
all:
  children:
    ldapservers:
      vars:
        ds389_instances:
          - name: localhost
            rootpw: "{{ vault_ds389_rootpw }}"
            backends: 
              - name: userroot
                suffix: dc=example,dc=com
                # ancestors
                index:
                  - name: myattr

      children:
        suppliers:
          vars:
            ds389_option_01:
              - name: localhost.userroot
                merge:
                  ReplicaRole: supplier
                  ReplicacwPort: 636
                  ReplicaTransportInfo: SSL
                  ReplicationManagerDN: cn=replication manager, cn=config
                  ReplicationManagerPassword: "{{ vault_ds389_replmanpw }}"
            ds389_agmts:
              - target: "{{ Group[consumers] }}"
          hosts:
            ds389vm1:
              ds389_option_02:
                - name: localhost.userroot
                  merge:
                    ReplicaId: 1
                - name: ds389_agmts
                  append:
                    - target: ds389vm2
                
            ds389vm2:
              ds389_option_02:
                - name: localhost.userroot
                  merge:
                    ReplicaId: 2
                - name: ds389_agmts
                  append:
                    - target: ds389vm1
                      ReplicaIgnoreMissingChange: once
                
        consumers:
          vars:
            ds389_option_01:
              - name: localhost.userroot
                merge:
                  ReplicaRole: consumer
                  ReplicacwPort: 636
                  ReplicaTransportInfo: SSL
                  ReplicationManagerDN: cn=replication manager, cn=config
                  ReplicationManagerPassword: "{{ vault_ds389_replmanpw }}"
          hosts:
            ds389vm3:
            ds389vm4:
